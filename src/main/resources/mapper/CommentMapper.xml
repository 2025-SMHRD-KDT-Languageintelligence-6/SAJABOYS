<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.chaser.mapper.CommentMapper">

    <!-- 댓글 + 대댓글 목록 -->
    <select id="getComments" resultType="com.project.chaser.dto.Comment">
        SELECT
        c.CommentIdx,
        c.SnsIdx,
        c.UserIdx,
        c.CommentContent,
        c.CreatedAt,
        u.Nickname AS userNickname,
        c.ParentIdx
        FROM comments c
        JOIN user u ON c.UserIdx = u.UserIdx
        WHERE c.SnsIdx = #{snsIdx}
        ORDER BY COALESCE(c.ParentIdx, c.CommentIdx) ASC, c.CreatedAt ASC
    </select>

    <!-- 댓글/대댓글 등록 -->
    <insert id="insertComment" parameterType="com.project.chaser.dto.Comment" useGeneratedKeys="true" keyProperty="CommentIdx">
        INSERT INTO comments (SnsIdx, UserIdx, CommentContent, ParentIdx)
        VALUES (#{SnsIdx}, #{UserIdx}, #{CommentContent}, #{ParentIdx})
    </insert>

</mapper>
