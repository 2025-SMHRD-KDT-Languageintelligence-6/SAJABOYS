<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.chaser.mapper.CommentMapper">

    <!-- 댓글 목록 (대댓글 포함) -->
    <select id="getComments" resultType="com.project.chaser.dto.Comment">
        SELECT
        c.CommentIdx,
        c.SnsIdx,
        c.UserIdx,
        c.CommentContent,
        c.CreatedAt,
        u.Nickname as UserNickname,
        c.ParentIdx
        FROM comments c
        JOIN user u ON c.UserIdx = u.UserIdx
        WHERE c.SnsIdx = #{SnsIdx}
        ORDER BY
        COALESCE(c.ParentIdx, c.CommentIdx) ASC,  -- 부모 댓글 기준으로 정렬
        c.CreatedAt ASC                          -- 댓글 순서
    </select>

    <!-- 댓글 등록 -->
    <insert id="insertComment" parameterType="com.project.chaser.dto.Comment">
        INSERT INTO comments (SnsIdx, UserIdx, CommentContent, ParentIdx)
        VALUES (#{SnsIdx}, #{UserIdx}, #{CommentContent}, #{ParentIdx})
    </insert>

</mapper>
